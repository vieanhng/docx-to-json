<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công cụ chuyển Word sang JSON</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- MathJax CSS for math rendering -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>Công cụ chuyển Word sang JSON</h1>
            <p class="subtitle">Tải lên và chỉnh sửa dữ liệu JSON với công thức toán học</p>
        </header>

        <div class="stats-container">
            <div class="stat-item">
                <span id="questionCount" class="stat-value">0</span>
                <span class="stat-label">Số lượng câu</span>
            </div>
            <div class="stat-item">
                <span id="mcCount" class="stat-value">0</span>
                <span class="stat-label">Trắc nghiệm</span>
            </div>
            <div class="stat-item">
                <span id="tfCount" class="stat-value">0</span>
                <span class="stat-label">Đúng/Sai</span>
            </div>
            <div class="stat-item">
                <span id="fillCount" class="stat-value">0</span>
                <span class="stat-label">Điền chỗ trống</span>
            </div>
        </div>

        <div class="floating-action-button">
            <button id="fabToggleBtn" class="btn btn-primary fab-toggle-btn">
                <i class="fas fa-magic"></i>
            </button>
            <div id="fabDropdown" class="fab-dropdown-content">
                <div class="batch-actions">
                    <div class="batch-actions-header">
                        <span>Công cụ</span>
                    </div>
                    <div class="batch-actions-content">
                        <div class="batch-action-group">
                            <div class="batch-action-title">Tạo hàng loạt bằng AI cho các câu được chọn</div>
                            <div class="batch-action-buttons">
                                <button id="batchGenerateSolutionBtn" class="btn-generate-all">
                                    <i class="fas fa-magic"></i> Tạo lời giải
                                </button>
                                <button id="batchGenerateHintBtn" class="btn-generate-all">
                                    <i class="fas fa-magic"></i> Tạo gợi ý
                                </button>
                                <button id="batchGenerateActionWordsBtn" class="btn-generate-all">
                                    <i class="fas fa-magic"></i> Tạo động từ
                                </button>
                                <button id="batchGenerateTagsBtn" class="btn-generate-all">
                                    <i class="fas fa-magic"></i> Tạo thẻ
                                </button>
                            </div>
                        </div>
                        <div class="batch-action-group">
                            <div class="batch-action-title">Số hóa</div>
                            <div class="batch-action-buttons">
                                <button id="digitize" class="btn-generate-all">
                                    <i class="fas fa-magic"></i> Số hóa
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="errorContainer" class="error-container">
            <div class="message-title">
                <div class="message-title-content">
                    <i class="fas fa-exclamation-circle error-icon"></i>
                    Lỗi
                </div>
                <button class="message-close-btn" onclick="hideAllMessages()">&times;</button>
            </div>
            <ul id="errorList" class="error-list"></ul>
        </div>

        <div id="warningContainer" class="warning-container">
            <div class="message-title">
                <div class="message-title-content">
                    <i class="fas fa-exclamation-triangle warning-icon"></i>
                    Cảnh báo
                </div>
                <button class="message-close-btn" onclick="hideAllMessages()">&times;</button>
            </div>
            <ul id="warningList" class="warning-list"></ul>
        </div>

        <div id="successContainer" class="success-container">
            <div class="message-title">
                <div class="message-title-content">
                    <i class="fas fa-check-circle success-icon"></i>
                    Thành công
                </div>
                <button class="message-close-btn" onclick="hideAllMessages()">&times;</button>
            </div>
            <p id="successMessage" class="success-message"></p>
        </div>

        <div class="main-container">
            <div class="editor-container">
                <div class="panel-header">
                    <div class="panel-title">
                        <i class="fas fa-code"></i>
                        <span>Chỉnh sửa JSON</span>
                    </div>
                    <div class="panel-actions">
                        <div class="math-toggle">
                            <span>Hiển thị công thức toán</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="mathToggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <button id="formatBtn" class="btn-secondary">
                            <i class="fas fa-align-left"></i>
                            Định dạng
                        </button>
                        <button id="applyBtn" class="btn-primary">
                            <i class="fas fa-check"></i>
                            Validate
                        </button>
                        <button id="downloadJsonBtn" class="btn-secondary">
                            <i class="fas fa-download"></i>
                            Tải xuống JSON
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <!-- Upload Tabs -->
                    <div class="upload-tabs">
                        <button class="upload-tab active" data-tab="file">
                            <i class="fas fa-file-upload"></i>
                            Upload File
                        </button>
                        <button class="upload-tab" data-tab="ai">
                            <i class="fas fa-brain"></i>
                            Nhập bằng ảnh/Text (coming soon...)
                        </button>
                    </div>

                    <!-- File Upload Tab Content -->
                    <div class="upload-tab-content active" id="fileTabContent">
                        <div class="file-upload-container" id="fileUploadContainer">
                            <label for="fileInput" class="file-upload-label">
                                <i class="fas fa-cloud-upload-alt file-upload-icon"></i>
                                <p class="file-upload-text">Kéo thả file JSON hoặc Word (.docx) vào đây hoặc nhấn để
                                    chọn
                                    file</p>
                            </label>
                            <input type="file" id="fileInput" accept=".json,.docx">
                            <div class="file-info" id="fileInfo">
                                <div class="file-info-name" id="fileName"></div>
                                <div class="file-info-size" id="fileSize"></div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Recognition Tab Content -->
                    <div class="upload-tab-content" id="aiTabContent">
                        <div class="ai-input-container">
                            <div class="ai-input-tabs">
                                <button class="ai-input-tab active" data-input="image">
                                    <i class="fas fa-image"></i>
                                    Ảnh
                                </button>
                                <button class="ai-input-tab" data-input="text">
                                    <i class="fas fa-keyboard"></i>
                                    Text
                                </button>
                            </div>

                            <!-- Image Input -->
                            <div class="ai-input-content active" id="imageInputContent">
                                <div class="image-upload-area" id="imageUploadArea">
                                    <label for="imageInput" class="image-upload-label">
                                        <i class="fas fa-camera file-upload-icon"></i>
                                        <p class="file-upload-text">Tải lên ảnh câu hỏi để AI nhận diện</p>
                                        <small>Hỗ trợ: JPG, PNG, JPEG</small>
                                    </label>
                                    <input type="file" id="imageInput" accept="image/*" multiple>
                                </div>
                                <div class="image-preview-container" id="imagePreviewContainer"></div>
                                <button id="recognizeImageBtn" class="btn-primary"
                                    style="display: none; margin-top: 1rem;">
                                    <i class="fas fa-magic"></i>
                                    Nhận diện câu hỏi
                                </button>
                            </div>

                            <!-- Text Input -->
                            <div class="ai-input-content" id="textInputContent">
                                <div class="text-input-area">
                                    <label class="form-label">Nhập nội dung câu hỏi:</label>
                                    <textarea id="textInput" class="form-control" rows="10"
                                        placeholder="Nhập hoặc dán nội dung câu hỏi vào đây...&#10;&#10;Ví dụ:&#10;Câu 1: Tính đạo hàm của hàm số y = x^2 + 3x - 1&#10;A. y' = 2x + 3&#10;B. y' = x + 3&#10;C. y' = 2x&#10;D. y' = 3x"></textarea>
                                    <button id="recognizeTextBtn" class="btn-primary" style="margin-top: 1rem;">
                                        <i class="fas fa-magic"></i>
                                        Nhận diện câu hỏi
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="editor-content">
                        <textarea id="jsonEditor"
                            placeholder="Nội dung JSON sẽ hiển thị ở đây sau khi tải lên..."></textarea>
                    </div>
                </div>
            </div>

            <div class="preview-container">
                <div class="panel-header">
                    <div class="panel-title">
                        <i class="fas fa-eye"></i>
                        <span>Xem trước</span>
                    </div>
                    <div class="panel-actions">
                        <button id="toggleEditorBtn" class="btn-secondary">
                            <i class="fas fa-code"></i>
                            Hiển thị/Ẩn JSON
                        </button>
                        <button id="selectAllBtn" class="btn-secondary">
                            <i class="fas fa-check-double"></i>
                            Chọn tất cả
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <div id="previewContainer" class="preview-content">
                        <div class="empty-state">
                            <i class="fas fa-file-alt"></i>
                            <p>Xem trước dữ liệu sẽ hiển thị ở đây</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for editing questions -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Chỉnh sửa câu hỏi</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="editType">Loại câu hỏi</label>
                    <select id="editType" class="form-control">
                        <option value="MC">Trắc nghiệm (MC)</option>
                        <option value="MMC">Trắc nghiệm nhiều đáp án (MMC)</option>
                        <option value="TF">Đúng/Sai (TF)</option>
                        <option value="SA">Điền vào chỗ trống (SA)</option>
                        <option value="MP">Ghép nối (MP)</option>
                        <option value="MDDM">Kéo thả (MDDM)</option>
                        <option value="MRO">Sắp xếp (MRO)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="editQuestion">Nội dung câu hỏi</label>
                    <textarea id="editQuestion" class="form-control" rows="3"></textarea>
                </div>

                <div id="mcOptionsContainer">
                    <div class="form-group">
                        <label class="form-label">Lựa chọn</label>
                        <div id="optionsContainer">
                            <!-- Options will be dynamically added here -->
                        </div>
                        <button type="button" id="addOptionBtn" class="btn-secondary" style="margin-top: 0.5rem;">
                            <i class="fas fa-plus"></i> Thêm lựa chọn
                        </button>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="editCorrectAnswer">Đáp án đúng</label>
                        <div id="correctAnswersContainer">
                            <!-- Correct answer checkboxes will be dynamically added here -->
                        </div>
                    </div>
                </div>

                <div id="tfStatementsContainer" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Khẳng định</label>
                        <div id="statementsContainer">
                            <!-- Statements will be dynamically added here -->
                        </div>
                        <button type="button" id="addStatementBtn" class="btn-secondary" style="margin-top: 0.5rem;">
                            <i class="fas fa-plus"></i> Thêm khẳng định
                        </button>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="editCorrectAnswerTF">Đáp án đúng</label>
                        <div id="correctAnswersContainerTF">
                            <!-- Correct answer checkboxes will be dynamically added here -->
                        </div>
                    </div>
                </div>

                <div id="fillAnswerContainer" style="display: none;">
                    <div class="form-group">
                        <label class="form-label" for="editAnswer">Đáp án</label>
                        <input type="text" id="editAnswer" class="form-control">
                    </div>
                </div>

                <div id="mpMatchingContainer" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Cột trái (Left)</label>
                        <div id="leftItemsContainer">
                            <!-- Left items will be dynamically added here -->
                        </div>
                        <button type="button" id="addLeftItemBtn" class="btn-secondary" style="margin-top: 0.5rem;">
                            <i class="fas fa-plus"></i> Thêm mục trái
                        </button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cột phải (Right)</label>
                        <div id="rightItemsContainer">
                            <!-- Right items will be dynamically added here -->
                        </div>
                        <button type="button" id="addRightItemBtn" class="btn-secondary" style="margin-top: 0.5rem;">
                            <i class="fas fa-plus"></i> Thêm mục phải
                        </button>
                    </div>
                </div>

                <div id="mddmDragDropContainer" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Các lựa chọn (Options)</label>
                        <div id="dragDropOptionsContainer">
                            <!-- Drag drop options will be dynamically added here -->
                        </div>
                        <button type="button" id="addDragDropOptionBtn" class="btn-secondary"
                            style="margin-top: 0.5rem;">
                            <i class="fas fa-plus"></i> Thêm lựa chọn
                        </button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Đáp án đúng (Correct Answer - chỉ số, ngăn cách bằng dấu phẩy)</label>
                        <input type="text" id="editCorrectAnswerMDDM" class="form-control" placeholder="Ví dụ: 0,2,1">
                        <small class="form-text">Nhập chỉ số của các lựa chọn đúng theo thứ tự vị trí (bắt đầu từ
                            0)</small>
                    </div>
                </div>

                <div id="mroReorderingContainer" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Các mục cần sắp xếp (Items - theo thứ tự đúng)</label>
                        <small class="form-text" style="display: block; margin-bottom: 0.5rem;">
                            Nhập các mục theo thứ tự đúng từ trên xuống dưới. Học sinh sẽ phải sắp xếp lại các mục
                            này.
                        </small>
                        <div id="reorderItemsContainer">
                            <!-- Reorder items will be dynamically added here -->
                        </div>
                        <button type="button" id="addReorderItemBtn" class="btn-secondary" style="margin-top: 0.5rem;">
                            <i class="fas fa-plus"></i> Thêm mục
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="editDifficultLevel">Mức độ</label>
                    <input type="text" id="editDifficultLevel" class="form-control" placeholder="Ví dụ: 1,2,3,4">
                </div>

                <div class="form-group">
                    <label class="form-label">Kỹ năng</label>
                    <div id="skillsMultiSelect" class="multi-select">
                        <div class="multi-select-trigger">
                            <span>Chọn kỹ năng</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="multi-select-dropdown">
                            <div class="multi-select-search">
                                <input type="text" class="form-control search-input" placeholder="Tìm kiếm kỹ năng...">
                            </div>
                            <div class="multi-select-options">
                                <!-- Skills options will be dynamically added here -->
                            </div>
                        </div>
                        <div class="multi-select-tags">
                            <!-- Selected skills will be displayed here -->
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="form-label-with-action">
                        <label class="form-label">Động từ chỉ thị</label>
                        <button type="button" id="generateActionWordsBtn" class="btn-generate">
                            <i class="fas fa-magic"></i> Tạo bằng AI
                        </button>
                    </div>
                    <div id="actionWordsMultiSelect" class="multi-select">
                        <div class="multi-select-trigger">
                            <span>Chọn động từ chỉ thị</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="multi-select-dropdown">
                            <div class="multi-select-search">
                                <input type="text" class="form-control search-input" placeholder="Tìm kiếm động từ...">
                            </div>
                            <div class="multi-select-options">
                                <!-- Action words options will be dynamically added here -->
                            </div>
                        </div>
                        <div class="multi-select-tags">
                            <!-- Selected action words will be displayed here -->
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="form-label-with-action">
                        <label class="form-label" for="editSolution">Lời giải chi tiết</label>
                        <button type="button" id="generateSolutionBtn" class="btn-generate">
                            <i class="fas fa-magic"></i> Tạo bằng AI
                        </button>
                    </div>
                    <textarea id="editSolution" class="form-control" rows="4"></textarea>
                </div>

                <div class="form-group">
                    <div class="form-label-with-action">
                        <label class="form-label" for="editHint">Gợi ý</label>
                        <button type="button" id="generateHintBtn" class="btn-generate">
                            <i class="fas fa-magic"></i> Tạo bằng AI
                        </button>
                    </div>
                    <textarea id="editHint" class="form-control" rows="2"></textarea>
                </div>

                <div class="form-group">
                    <div class="form-label-with-action">
                        <label class="form-label" for="editTags">Thẻ (ngăn cách bằng dấu chấm phẩy)</label>
                        <button type="button" id="generateTagsBtn" class="btn-generate">
                            <i class="fas fa-magic"></i> Tạo bằng AI
                        </button>
                    </div>
                    <input type="text" id="editTags" class="form-control">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="cancelEditBtn" class="btn-secondary">Hủy</button>
                <button type="button" id="saveEditBtn" class="btn-primary">Lưu thay đổi</button>
            </div>
        </div>
    </div>

    <!-- Digitize Modal -->
    <div id="digitizeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Số hóa dữ liệu</h3>
                <button class="modal-close" id="digitizeModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div id="digitizeStep1" class="digitize-step" style="display: none;">
                    <h4>Bước 1: Đăng nhập</h4>
                    <div class="form-group">
                        <label class="form-label" for="digitizeUsername">Tài khoản</label>
                        <input type="text" id="digitizeUsername" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="digitizePassword">Mật khẩu</label>
                        <input type="password" id="digitizePassword" class="form-control">
                    </div>
                    <button type="button" id="digitizeLoginBtn" class="btn-primary">Đăng nhập</button>
                </div>
                <div id="digitizeStep2" class="digitize-step" style="display: none;">
                    <h4>Bước 2: Nhập link ngân hàng</h4>
                    <div class="form-group">
                        <label class="form-label" for="digitizeBankLink">Link ngân hàng</label>
                        <input type="text" id="digitizeBankLink" class="form-control">
                    </div>
                    <button type="button" id="digitizeVerifyLinkBtn" class="btn-primary">Xác nhận link</button>
                    <button type="button" id="digitizeBackToStep1Btn" class="btn-secondary">Quay lại</button>
                </div>
                <div id="digitizeStep3" class="digitize-step" style="display: none;">
                    <h4>Bước 3: Số hóa</h4>
                    <p class="digitize-bank-name">Ngân hàng: <span id="digitizeBankName"></span></p>
                    <p>Sẵn sàng để số hóa dữ liệu câu hỏi hiện tại?</p>
                    <button type="button" id="digitizeConfirmBtn" class="btn-primary">Xác nhận số hóa</button>
                    <button type="button" id="digitizeBackToStep2Btn" class="btn-secondary">Quay lại</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MathJax JS for math rendering -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: true,
                packages: ['base', 'ams', 'noerrors', 'noundefined', 'newcommand', 'boldsymbol']
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code', 'img'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="script.js"></script>
</body>

</html>